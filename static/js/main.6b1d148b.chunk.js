(this["webpackJsonpvtube-studio-tagger"]=this["webpackJsonpvtube-studio-tagger"]||[]).push([[0],{23:function(e,t,n){},25:function(e,t,n){},29:function(e,t,n){"use strict";n.r(t);var r=n(1),o=n.n(r),i=n(16),c=n.n(i),a=(n(23),n(6)),s=n(13),l=n(4),u=n(8),d=n(3),h=n.n(d),f=n(5),v=n(2),b=(n(25),n(10)),j=n(17),p=n(18),g=function(){function e(t,n){Object(j.a)(this,e),this.ws=void 0,this._url=void 0,this._protocols=void 0,this.bufferedSends=[],this.eventListeners=new Map,this.reconnectHandle=null,this.reconnectTimeout=0,this.onopen=null,this.onmessage=null,this.onerror=null,this.onclose=null,this._url=t,this._protocols=n,this.performReconnect()}return Object(p.a)(e,[{key:"url",get:function(){return this._url},set:function(e){e!==this._url&&(this._url=e,this.performReconnect())}},{key:"protocol",get:function(){return this.ws.protocol}},{key:"readyState",get:function(){return this.ws.readyState}},{key:"binaryType",get:function(){return this.ws.binaryType},set:function(e){this.ws.binaryType=e}},{key:"bufferedAmount",get:function(){return this.ws.bufferedAmount}},{key:"extensions",get:function(){return this.ws.extensions}},{key:"CLOSED",get:function(){return this.ws.CLOSED}},{key:"CLOSING",get:function(){return this.ws.CLOSING}},{key:"CONNECTING",get:function(){return this.ws.CONNECTING}},{key:"OPEN",get:function(){return this.ws.OPEN}},{key:"addEventListener",value:function(e,t,n){var r,o=null!==(r=this.eventListeners.get(e))&&void 0!==r?r:[];o.push({listener:t,options:n}),this.eventListeners.set(e,o),"close"!==e&&"error"!==e&&this.ws.addEventListener(e,t,n)}},{key:"removeEventListener",value:function(e,t,n){var r,o=null!==(r=this.eventListeners.get(e))&&void 0!==r?r:[],i=o.findIndex((function(e){return e.listener===t&&(e.options===n||"object"===typeof e.options&&"object"===typeof n&&e.options.capture===n.capture)}));i>=0&&o.splice(i,1),this.ws.removeEventListener(e,t,n)}},{key:"dispatchEvent",value:function(e){return this.ws.dispatchEvent(e)}},{key:"close",value:function(e,t){this.ws.close(e,t)}},{key:"send",value:function(e){this.ws.readyState===this.ws.OPEN?this.ws.send(e):this.bufferedSends.unshift(e)}},{key:"performReconnect",value:function(){var e=this;try{var t,n,r,o,i,c=this.ws;c&&c.readyState===c.OPEN&&c.close(3012,"Reconnecting");var a=new WebSocket(c?this._url:"wss://echo.websocket.org",this._protocols);a.binaryType=null!==(t=null===c||void 0===c?void 0:c.binaryType)&&void 0!==t?t:a.binaryType,a.onopen=null!==(n=null===c||void 0===c?void 0:c.onopen)&&void 0!==n?n:a.onopen,a.onmessage=null!==(r=null===c||void 0===c?void 0:c.onmessage)&&void 0!==r?r:a.onmessage,a.onerror=null!==(o=null===c||void 0===c?void 0:c.onerror)&&void 0!==o?o:a.onerror,a.onclose=null!==(i=null===c||void 0===c?void 0:c.onclose)&&void 0!==i?i:a.onclose,this.ws=a,c||this.reconnect();var s,l=Object(u.a)(this.eventListeners.entries());try{for(l.s();!(s=l.n()).done;){var d,h=Object(v.a)(s.value,2),f=h[0],b=h[1],j=Object(u.a)(b);try{for(j.s();!(d=j.n()).done;){var p=d.value;c&&c.removeEventListener(f,p.listener,p.options),a.addEventListener(f,p.listener,p.options)}}catch(g){j.e(g)}finally{j.f()}}}catch(g){l.e(g)}finally{l.f()}a.addEventListener("open",(function(t){var n;if(a===e.ws)for(e.reconnectTimeout=0,null===(n=e.onopen)||void 0===n||n.call(e,t);e.bufferedSends.length;)a.send(e.bufferedSends.pop());else a.close(3012,"Reconnecting")})),a.addEventListener("message",(function(t){var n;null===(n=e.onmessage)||void 0===n||n.call(e,t)})),a.addEventListener("error",(function(t){var n;null===(n=e.onerror)||void 0===n||n.call(e,t)})),a.addEventListener("close",(function(t){var n;null===(n=e.onclose)||void 0===n||n.call(e,t),a===e.ws&&e.reconnect()}))}catch(O){console.error(O),this.reconnect()}}},{key:"reconnect",value:function(){var e=this;this.reconnectHandle&&(clearTimeout(this.reconnectHandle),this.reconnectHandle=null),this.reconnectHandle=window.setTimeout((function(){return e.performReconnect()}),this.reconnectTimeout),this.reconnectTimeout=Math.min(32e3,2*Math.max(1e3,this.reconnectTimeout))}}]),e}();function O(e){return e.UserData.reduce((function(e,t){return Object(l.a)(Object(l.a)({},e),{},Object(a.a)({},t.Id,t.Value.trim().split(/\s+/)))}),{})}function m(e){for(var t=[],n=0,r=Object.keys(e);n<r.length;n++){var o=r[n],i={Target:"ArtMesh",Id:o,Value:e[o].join(" ")};t.push(i)}var c=t.reduce((function(e,t){return e+t.Value.length}),0);return{Version:3,Meta:{UserDataCount:t.length,TotalUserDataSize:c},UserData:t}}var y=n(0),x="vtstudio-tagger-token",w="vtstudio-tagger-filter";var k=function(){var e,t=Object(r.useState)(8001),n=Object(v.a)(t,2),o=n[0],i=n[1],c=Object(r.useState)((function(){var e;return null!==(e=localStorage.getItem(w))&&void 0!==e?e:""})),d=Object(v.a)(c,2),j=d[0],p=d[1],k=Object(r.useState)(!1),S=Object(v.a)(k,2),T=S[0],E=S[1],L=Object(r.useState)(""),C=Object(v.a)(L,2),N=C[0],M=C[1],A=Object(r.useState)("magenta"),I=Object(v.a)(A,2),R=I[0],D=I[1],F=Object(r.useState)(""),B=Object(v.a)(F,2),P=B[0],G=B[1],V=Object(r.useState)(null),H=Object(v.a)(V,2),_=H[0],J=H[1],U=Object(r.useState)(null),Y=Object(v.a)(U,2),W=Y[0],z=Y[1],K=Object(r.useState)(null),q=Object(v.a)(K,2),Q=q[0],X=q[1],Z=Object(r.useState)(null),$=Object(v.a)(Z,2),ee=$[0],te=$[1],ne=Object(r.useState)(""),re=Object(v.a)(ne,2),oe=re[0],ie=re[1],ce=Object(r.useRef)(null),ae=Object(r.useMemo)((function(){var e,t=new g("ws://localhost:8001"),n=new b.WebSocketBus(t),r=new b.ApiClient(n),o=null!==(e=localStorage.getItem(x))&&void 0!==e?e:void 0,i=new b.Plugin(r,"ArtMesh Tagger","Hawkbar",void 0,o,(function(e){return localStorage.setItem(x,e)}));return t.addEventListener("open",(function(){return E(!0)})),t.addEventListener("close",(function(){return E(!1)})),{plugin:i,ws:t}}),[]),se=ae.plugin,le=ae.ws;Object(r.useEffect)((function(){le.url="ws://localhost:".concat(o)}),[le,o]),Object(r.useEffect)((function(){var e=setInterval(Object(f.a)(h.a.mark((function e(){var t,n,r,o,i,c,a;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!T){e.next=29;break}return e.prev=1,e.next=4,se.apiClient.currentModel();case 4:if(t=e.sent,n=t.modelLoaded,r=t.live2DModelName,!n){e.next=20;break}return(o=r.substr(0,r.indexOf(".model3.json")))!==P&&(X(null),te(null)),G(o),e.next=13,se.apiClient.artMeshList();case 13:i=e.sent,c=i.artMeshNames,a=i.artMeshTags,J(c),z(a),e.next=23;break;case 20:G(""),J([]),z([]);case 23:e.next=29;break;case 25:e.prev=25,e.t0=e.catch(1),console.error(e.t0),M(""+e.t0);case 29:case"end":return e.stop()}}),e,null,[[1,25]])}))),1e3);return function(){return clearInterval(e)}}),[se,T,P]),Object(r.useEffect)((function(){var e=function(e){1===e.key.length?(ce.current&&ce.current.focus(),p((function(t){return t+e.key}))):"Backspace"===e.key&&(ce.current&&ce.current.focus(),p((function(e){return e.substr(0,e.length-1)})))};return window.addEventListener("keydown",e),function(){return window.removeEventListener("keydown",e)}}),[]);var ue=Object(r.useMemo)((function(){if(null===Q&&null===ee)return!1;return function(e,t){for(var n in e){if(!t[n])return!0;var r,o=Object(u.a)(e[n]);try{for(o.s();!(r=o.n()).done;){var i=r.value;if(!t[n].includes(i))return!0}}catch(d){o.e(d)}finally{o.f()}}for(var c in t){if(!e[c])return!0;var a,s=Object(u.a)(t[c]);try{for(s.s();!(a=s.n()).done;){var l=a.value;if(!e[c].includes(l))return!0}}catch(d){s.e(d)}finally{s.f()}}return!1}(null!==Q&&void 0!==Q?Q:{},null!==ee&&void 0!==ee?ee:{})}),[Q,ee]);Object(r.useEffect)((function(){var e=function(){if(ue)return"You have unsaved changes. You will need to download and place the userdata3.json file in your model folder to update the tags. Are you sure you want to leave without saving?"};return window.addEventListener("beforeunload",e),function(){return window.removeEventListener("beforeunload",e)}}),[ue]);var de=function(){var e=Object(f.a)(h.a.mark((function e(t){var n,r;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}return e.abrupt("return");case 2:return e.prev=2,e.t0=JSON,e.next=6,t.text();case 6:e.t1=e.sent,n=e.t0.parse.call(e.t0,e.t1),r=O(n),te(r),X(JSON.parse(JSON.stringify(r))),e.next=17;break;case 13:e.prev=13,e.t2=e.catch(2),console.error(e.t2),alert("Could not process the uploaded UserData");case 17:case"end":return e.stop()}}),e,null,[[2,13]])})));return function(t){return e.apply(this,arguments)}}(),he=function(){var e=Object(f.a)(h.a.mark((function e(){var t,n;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=m(null!==ee&&void 0!==ee?ee:{}),(n=document.createElement("a")).href="data:application/json;charset=utf-8,"+encodeURIComponent(JSON.stringify(t)),n.download="".concat(P,".userdata3.json"),n.hidden=!0,document.body.append(n),n.click(),X(JSON.parse(JSON.stringify(ee)));case 8:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),fe={white:{colorR:255,colorG:255,colorB:255,colorA:255},cyan:{colorR:0,colorG:255,colorB:255,colorA:255},magenta:{colorR:255,colorG:0,colorB:255,colorA:255},yellow:{colorR:255,colorG:255,colorB:0,colorA:255}},ve=function(){var e=Object(f.a)(h.a.mark((function e(t){return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!oe){e.next=2;break}return e.abrupt("return");case 2:return e.prev=2,e.next=5,se.apiClient.colorTint({colorTint:{colorR:255,colorG:255,colorB:255,colorA:63},artMeshMatcher:{tintAll:!0}});case 5:return e.next=7,se.apiClient.colorTint({colorTint:fe[R],artMeshMatcher:{tintAll:!1,nameExact:[t]}});case 7:e.next=13;break;case 9:e.prev=9,e.t0=e.catch(2),console.error(e.t0),M(""+e.t0);case 13:case"end":return e.stop()}}),e,null,[[2,9]])})));return function(t){return e.apply(this,arguments)}}(),be=function(){var e=Object(f.a)(h.a.mark((function e(t){return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!oe){e.next=2;break}return e.abrupt("return");case 2:return e.prev=2,e.next=5,se.apiClient.colorTint({colorTint:{colorR:255,colorG:255,colorB:255,colorA:255},artMeshMatcher:{tintAll:!0}});case 5:e.next=11;break;case 7:e.prev=7,e.t0=e.catch(2),console.error(e.t0),M(""+e.t0);case 11:case"end":return e.stop()}}),e,null,[[2,7]])})));return function(t){return e.apply(this,arguments)}}(),je=function(e,t){var n,r;t&&!(null===ee||void 0===ee||null===(n=ee[e])||void 0===n?void 0:n.includes(t))&&te(Object(l.a)(Object(l.a)({},ee),{},Object(a.a)({},e,[].concat(Object(s.a)(null!==(r=null===ee||void 0===ee?void 0:ee[e])&&void 0!==r?r:[]),[t]))))},pe=function(){var e=Object(f.a)(h.a.mark((function e(t,n){return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.stopPropagation(),ie(oe===n?"":n),oe===n){e.next=7;break}return e.next=5,se.apiClient.colorTint({colorTint:{colorR:255,colorG:255,colorB:255,colorA:63},artMeshMatcher:{tintAll:!0}});case 5:return e.next=7,se.apiClient.colorTint({colorTint:fe[R],artMeshMatcher:{tintAll:!1,nameExact:[n]}});case 7:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),ge=j?null!==(e=null===_||void 0===_?void 0:_.filter((function(e){return e.toLowerCase().includes(j.toLowerCase())})))&&void 0!==e?e:[]:null!==_&&void 0!==_?_:[],Oe=Object(s.a)(ge).sort(),me=W&&W.length>0&&!ee;return Object(y.jsxs)("div",{className:"App",children:[T?null:Object(y.jsxs)(y.Fragment,{children:[Object(y.jsxs)("label",{children:["VTube Studio API Port:\xa0",Object(y.jsx)("input",{type:"number",value:o,onChange:function(e){return i(e.target.valueAsNumber)}})]}),Object(y.jsx)("br",{})]}),T&&!N?Object(y.jsxs)(y.Fragment,{children:[me?Object(y.jsxs)(y.Fragment,{children:[Object(y.jsx)("div",{children:"The currently loaded model has existing tags but no UserData file has been loaded. Please select the model's userdata3.json file:"}),Object(y.jsx)("input",{type:"file",onChange:function(e){var t;return de(null===(t=e.target.files)||void 0===t?void 0:t[0])}}),Object(y.jsx)("br",{})]}):null,!W||W.length||ee?null:Object(y.jsxs)(y.Fragment,{children:[Object(y.jsx)("div",{children:"The currently loaded model has no existing tags. A new UserData file will be generated when you start adding tags, or you can upload your existing userdata3.json file:"}),Object(y.jsx)("input",{type:"file",onChange:function(e){var t;return de(null===(t=e.target.files)||void 0===t?void 0:t[0])}}),Object(y.jsx)("br",{})]}),ue?Object(y.jsxs)(y.Fragment,{children:[Object(y.jsx)("div",{children:"To save your changes, download the updated userdata3.json file and place it next to the model3.json file in your model's folder in VTube Studio:"}),Object(y.jsx)("button",{onClick:function(){return he()},children:"Download userdata3.json"})]}):Object(y.jsx)(y.Fragment,{children:Object(y.jsx)("div",{children:"You have no unsaved changes."})}),_&&_.length?Object(y.jsxs)(y.Fragment,{children:[Object(y.jsx)("br",{}),Object(y.jsxs)("i",{children:["Note: Hovering over the art mesh names will highlight them in VTube Studio, and clicking a name will keep it highlighted until it is clicked again. Highlight color:\xa0",Object(y.jsx)("select",{value:R,onChange:function(e){return D(e.target.value)},children:Object.keys(fe).map((function(e){return Object(y.jsx)("option",{children:e},e)}))})]})]}):null,Object(y.jsx)("h3",{children:P}),Object(y.jsxs)("label",{children:["Filter:\xa0",Object(y.jsx)("input",{ref:ce,type:"text",defaultValue:j,onChange:function(e){return function(e){localStorage.setItem(w,e),p(e)}(e.target.value)}})]}),Object(y.jsx)("br",{})]}):null,T&&!N?Object(y.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"auto 1fr"},children:[Object(y.jsx)("label",{children:"ArtMesh Name"}),Object(y.jsx)("label",{children:"Tags"}),Oe?Oe.map((function(e,t){var n;return Object(y.jsxs)(r.Fragment,{children:[Object(y.jsxs)("div",{className:"artmeshName"+(oe===e?" selected":""),onClick:function(t){return pe(t,e)},onMouseEnter:function(){return ve(e)},onMouseLeave:function(){return be(e)},children:[e,oe===e?"\ud83d\udccc":""]}),Object(y.jsxs)("div",{className:"artmeshTags",onMouseEnter:function(){return ve(e)},onMouseLeave:function(){return be(e)},children:[me?null:Object(y.jsx)("input",{type:"text",placeholder:"New tag...",onKeyDown:function(t){t.stopPropagation(),"Enter"===t.key&&t.target instanceof HTMLInputElement&&(je(e,t.target.value),t.target.value="")},onBlur:function(t){je(e,t.target.value),t.target.value=""}}),null===ee||void 0===ee||null===(n=ee[e])||void 0===n?void 0:n.map((function(t){return Object(y.jsxs)("div",{className:"tag",onClick:function(){return function(e,t){if(t&&ee&&ee[e]&&ee[e].includes(t)){var n=1===ee[e].length,r=Object(l.a)({},ee);n?delete r[e]:r[e]=r[e].filter((function(e){return e!==t})),te(r)}}(e,t)},children:[Object(y.jsx)("span",{children:t}),Object(y.jsx)("div",{children:"\xd7"})]},t)}))]})]},e+t)})):Object(y.jsx)("i",{children:"No model is currently loaded. Load a model to view the list of artmeshes and tags."})]}):Object(y.jsx)("i",{title:N,children:"Not connected to VTube Studio. Ensure that you are running the latest version of VTube Studio on the same device as this webpage and that the port matches in the settings."}),Object(y.jsx)("i",{children:"If you are experiencing connection issues with VTube Studio, try refreshing the page."})]})},S=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,30)).then((function(t){var n=t.getCLS,r=t.getFID,o=t.getFCP,i=t.getLCP,c=t.getTTFB;n(e),r(e),o(e),i(e),c(e)}))};c.a.render(Object(y.jsx)(o.a.StrictMode,{children:Object(y.jsx)(k,{})}),document.getElementById("root")),S()}},[[29,1,2]]]);
//# sourceMappingURL=main.6b1d148b.chunk.js.map