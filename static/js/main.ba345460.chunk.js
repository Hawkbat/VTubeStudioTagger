(this["webpackJsonpvtube-studio-tagger"]=this["webpackJsonpvtube-studio-tagger"]||[]).push([[0],{23:function(e,t,n){},25:function(e,t,n){},29:function(e,t,n){"use strict";n.r(t);var r=n(1),o=n.n(r),i=n(16),s=n.n(i),a=(n(23),n(5)),c=n(13),u=n(4),l=n(7),d=n(3),f=n.n(d),v=n(8),h=n(2),b=(n(25),n(10)),j=n(17),p=n(18),g=function(){function e(t,n){Object(j.a)(this,e),this.ws=void 0,this._url=void 0,this._protocols=void 0,this.bufferedSends=[],this.eventListeners=new Map,this.reconnectHandle=null,this.reconnectTimeout=0,this.onopen=null,this.onmessage=null,this.onerror=null,this.onclose=null,this._url=t,this._protocols=n,this.performReconnect()}return Object(p.a)(e,[{key:"url",get:function(){return this._url},set:function(e){e!==this._url&&(this._url=e,this.performReconnect())}},{key:"protocol",get:function(){return this.ws.protocol}},{key:"readyState",get:function(){return this.ws.readyState}},{key:"binaryType",get:function(){return this.ws.binaryType},set:function(e){this.ws.binaryType=e}},{key:"bufferedAmount",get:function(){return this.ws.bufferedAmount}},{key:"extensions",get:function(){return this.ws.extensions}},{key:"CLOSED",get:function(){return this.ws.CLOSED}},{key:"CLOSING",get:function(){return this.ws.CLOSING}},{key:"CONNECTING",get:function(){return this.ws.CONNECTING}},{key:"OPEN",get:function(){return this.ws.OPEN}},{key:"addEventListener",value:function(e,t,n){var r,o=null!==(r=this.eventListeners.get(e))&&void 0!==r?r:[];o.push({listener:t,options:n}),this.eventListeners.set(e,o),"close"!==e&&"error"!==e&&this.ws.addEventListener(e,t,n)}},{key:"removeEventListener",value:function(e,t,n){var r,o=null!==(r=this.eventListeners.get(e))&&void 0!==r?r:[],i=o.findIndex((function(e){return e.listener===t&&(e.options===n||"object"===typeof e.options&&"object"===typeof n&&e.options.capture===n.capture)}));i>=0&&o.splice(i,1),this.ws.removeEventListener(e,t,n)}},{key:"dispatchEvent",value:function(e){return this.ws.dispatchEvent(e)}},{key:"close",value:function(e,t){this.ws.close(e,t)}},{key:"send",value:function(e){this.ws.readyState===this.ws.OPEN?this.ws.send(e):this.bufferedSends.unshift(e)}},{key:"performReconnect",value:function(){var e=this;try{var t,n,r,o,i,s=this.ws;s&&s.readyState===s.OPEN&&s.close(3012,"Reconnecting");var a=new WebSocket(s?this._url:"wss://echo.websocket.org",this._protocols);a.binaryType=null!==(t=null===s||void 0===s?void 0:s.binaryType)&&void 0!==t?t:a.binaryType,a.onopen=null!==(n=null===s||void 0===s?void 0:s.onopen)&&void 0!==n?n:a.onopen,a.onmessage=null!==(r=null===s||void 0===s?void 0:s.onmessage)&&void 0!==r?r:a.onmessage,a.onerror=null!==(o=null===s||void 0===s?void 0:s.onerror)&&void 0!==o?o:a.onerror,a.onclose=null!==(i=null===s||void 0===s?void 0:s.onclose)&&void 0!==i?i:a.onclose,this.ws=a,s||this.reconnect();var c,u=Object(l.a)(this.eventListeners.entries());try{for(u.s();!(c=u.n()).done;){var d,f=Object(h.a)(c.value,2),v=f[0],b=f[1],j=Object(l.a)(b);try{for(j.s();!(d=j.n()).done;){var p=d.value;s&&s.removeEventListener(v,p.listener,p.options),a.addEventListener(v,p.listener,p.options)}}catch(g){j.e(g)}finally{j.f()}}}catch(g){u.e(g)}finally{u.f()}a.addEventListener("open",(function(t){var n;if(a===e.ws)for(e.reconnectTimeout=0,null===(n=e.onopen)||void 0===n||n.call(e,t);e.bufferedSends.length;)a.send(e.bufferedSends.pop());else a.close(3012,"Reconnecting")})),a.addEventListener("message",(function(t){var n;null===(n=e.onmessage)||void 0===n||n.call(e,t)})),a.addEventListener("error",(function(t){var n;null===(n=e.onerror)||void 0===n||n.call(e,t)})),a.addEventListener("close",(function(t){var n;null===(n=e.onclose)||void 0===n||n.call(e,t),a===e.ws&&e.reconnect()}))}catch(O){console.error(O),this.reconnect()}}},{key:"reconnect",value:function(){var e=this;this.reconnectHandle&&(clearTimeout(this.reconnectHandle),this.reconnectHandle=null),this.reconnectHandle=window.setTimeout((function(){return e.performReconnect()}),this.reconnectTimeout),this.reconnectTimeout=Math.min(32e3,2*Math.max(1e3,this.reconnectTimeout))}}]),e}();function O(e){return e.UserData.reduce((function(e,t){return Object(u.a)(Object(u.a)({},e),{},Object(a.a)({},t.Id,t.Value.trim().split(/\s+/)))}),{})}function m(e){for(var t=[],n=0,r=Object.keys(e);n<r.length;n++){var o=r[n],i={Target:"ArtMesh",Id:o,Value:e[o].join(" ")};t.push(i)}var s=t.reduce((function(e,t){return e+t.Value.length}),0);return{Version:3,Meta:{UserDataCount:t.length,TotalUserDataSize:s},UserData:t}}var y=n(0),w="vtstudio-tagger-token",x="vtstudio-tagger-filter";var k=function(){var e,t=Object(r.useState)(8001),n=Object(h.a)(t,2),o=n[0],i=n[1],s=Object(r.useState)((function(){var e;return null!==(e=localStorage.getItem(x))&&void 0!==e?e:""})),d=Object(h.a)(s,2),j=d[0],p=d[1],k=Object(r.useState)(!1),S=Object(h.a)(k,2),E=S[0],T=S[1],L=Object(r.useState)(""),N=Object(h.a)(L,2),C=N[0],M=N[1],I=Object(r.useState)(""),A=Object(h.a)(I,2),D=A[0],F=A[1],P=Object(r.useState)(null),R=Object(h.a)(P,2),V=R[0],_=R[1],H=Object(r.useState)(null),J=Object(h.a)(H,2),U=J[0],B=J[1],G=Object(r.useState)(null),Y=Object(h.a)(G,2),W=Y[0],z=Y[1],K=Object(r.useState)(null),q=Object(h.a)(K,2),Q=q[0],X=q[1],Z=Object(r.useRef)(null),$=Object(r.useMemo)((function(){var e,t=new g("ws://localhost:8001"),n=new b.WebSocketBus(t),r=new b.ApiClient(n),o=null!==(e=localStorage.getItem(w))&&void 0!==e?e:void 0,i=new b.Plugin(r,"ArtMesh Tagger","Hawkbar",void 0,o,(function(e){return localStorage.setItem(w,e)}));return t.addEventListener("open",(function(){return T(!0)})),t.addEventListener("close",(function(){return T(!1)})),{plugin:i,ws:t}}),[]),ee=$.plugin,te=$.ws;Object(r.useEffect)((function(){te.url="ws://localhost:".concat(o)}),[te,o]),Object(r.useEffect)((function(){var e=setInterval(Object(v.a)(f.a.mark((function e(){var t,n,r,o,i,s,a;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!E){e.next=29;break}return e.prev=1,e.next=4,ee.apiClient.currentModel();case 4:if(t=e.sent,n=t.modelLoaded,r=t.live2DModelName,!n){e.next=20;break}return(o=r.substr(0,r.indexOf(".model3.json")))!==D&&(z(null),X(null)),F(o),e.next=13,ee.apiClient.artMeshList();case 13:i=e.sent,s=i.artMeshNames,a=i.artMeshTags,_(s),B(a),e.next=23;break;case 20:F(""),_([]),B([]);case 23:e.next=29;break;case 25:e.prev=25,e.t0=e.catch(1),console.error(e.t0),M(""+e.t0);case 29:case"end":return e.stop()}}),e,null,[[1,25]])}))),1e3);return function(){return clearInterval(e)}}),[ee,E,D]),Object(r.useEffect)((function(){var e=function(e){1===e.key.length?(Z.current&&Z.current.focus(),p((function(t){return t+e.key}))):"Backspace"===e.key&&(Z.current&&Z.current.focus(),p((function(e){return e.substr(0,e.length-1)})))};return window.addEventListener("keydown",e),function(){return window.removeEventListener("keydown",e)}}),[]);var ne=Object(r.useMemo)((function(){if(null===W&&null===Q)return!1;return function(e,t){for(var n in e){if(!t[n])return!0;var r,o=Object(l.a)(e[n]);try{for(o.s();!(r=o.n()).done;){var i=r.value;if(!t[n].includes(i))return!0}}catch(d){o.e(d)}finally{o.f()}}for(var s in t){if(!e[s])return!0;var a,c=Object(l.a)(t[s]);try{for(c.s();!(a=c.n()).done;){var u=a.value;if(!e[s].includes(u))return!0}}catch(d){c.e(d)}finally{c.f()}}return!1}(null!==W&&void 0!==W?W:{},null!==Q&&void 0!==Q?Q:{})}),[W,Q]);Object(r.useEffect)((function(){var e=function(){if(ne)return"You have unsaved changes. You will need to download and place the userdata3.json file in your model folder to update the tags. Are you sure you want to leave without saving?"};return window.addEventListener("beforeunload",e),function(){return window.removeEventListener("beforeunload",e)}}),[ne]);var re=function(){var e=Object(v.a)(f.a.mark((function e(t){var n,r;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}return e.abrupt("return");case 2:return e.prev=2,e.t0=JSON,e.next=6,t.text();case 6:e.t1=e.sent,n=e.t0.parse.call(e.t0,e.t1),r=O(n),X(r),z(JSON.parse(JSON.stringify(r))),e.next=17;break;case 13:e.prev=13,e.t2=e.catch(2),console.error(e.t2),alert("Could not process the uploaded UserData");case 17:case"end":return e.stop()}}),e,null,[[2,13]])})));return function(t){return e.apply(this,arguments)}}(),oe=function(){var e=Object(v.a)(f.a.mark((function e(){var t,n;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=m(null!==Q&&void 0!==Q?Q:{}),(n=document.createElement("a")).href="data:application/json;charset=utf-8,"+encodeURIComponent(JSON.stringify(t)),n.download="".concat(D,".userdata3.json"),n.hidden=!0,document.body.append(n),n.click(),z(JSON.parse(JSON.stringify(Q)));case 8:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),ie=function(){var e=Object(v.a)(f.a.mark((function e(t){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,ee.apiClient.colorTint({colorTint:{colorR:127,colorG:127,colorB:127,colorA:191},artMeshMatcher:{tintAll:!1,nameExact:[t]}});case 3:e.next=9;break;case 5:e.prev=5,e.t0=e.catch(0),console.error(e.t0),M(""+e.t0);case 9:case"end":return e.stop()}}),e,null,[[0,5]])})));return function(t){return e.apply(this,arguments)}}(),se=function(){var e=Object(v.a)(f.a.mark((function e(t){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,ee.apiClient.colorTint({colorTint:{colorR:255,colorG:255,colorB:255,colorA:255},artMeshMatcher:{tintAll:!1,nameExact:[t]}});case 3:e.next=9;break;case 5:e.prev=5,e.t0=e.catch(0),console.error(e.t0),M(""+e.t0);case 9:case"end":return e.stop()}}),e,null,[[0,5]])})));return function(t){return e.apply(this,arguments)}}(),ae=function(e,t){var n,r;t&&!(null===Q||void 0===Q||null===(n=Q[e])||void 0===n?void 0:n.includes(t))&&X(Object(u.a)(Object(u.a)({},Q),{},Object(a.a)({},e,[].concat(Object(c.a)(null!==(r=null===Q||void 0===Q?void 0:Q[e])&&void 0!==r?r:[]),[t]))))},ce=j?null!==(e=null===V||void 0===V?void 0:V.filter((function(e){return e.toLowerCase().includes(j.toLowerCase())})))&&void 0!==e?e:[]:null!==V&&void 0!==V?V:[],ue=Object(c.a)(ce).sort(),le=U&&U.length>0&&!Q;return Object(y.jsxs)("div",{className:"App",children:[E?null:Object(y.jsxs)(y.Fragment,{children:[Object(y.jsxs)("label",{children:["VTube Studio API Port:\xa0",Object(y.jsx)("input",{type:"number",value:o,onChange:function(e){return i(e.target.valueAsNumber)}})]}),Object(y.jsx)("br",{})]}),E&&!C?Object(y.jsxs)(y.Fragment,{children:[le?Object(y.jsxs)(y.Fragment,{children:[Object(y.jsx)("div",{children:"The currently loaded model has existing tags but no UserData file has been loaded. Please select the model's userdata3.json file:"}),Object(y.jsx)("input",{type:"file",onChange:function(e){var t;return re(null===(t=e.target.files)||void 0===t?void 0:t[0])}}),Object(y.jsx)("br",{})]}):null,!U||U.length||Q?null:Object(y.jsxs)(y.Fragment,{children:[Object(y.jsx)("div",{children:"The currently loaded model has no existing tags. A new UserData file will be generated when you start adding tags, or you can upload your existing userdata3.json file:"}),Object(y.jsx)("input",{type:"file",onChange:function(e){var t;return re(null===(t=e.target.files)||void 0===t?void 0:t[0])}}),Object(y.jsx)("br",{})]}),ne?Object(y.jsxs)(y.Fragment,{children:[Object(y.jsx)("div",{children:"To save your changes, download the updated userdata3.json file and place it next to the model3.json file in your model's folder in VTube Studio:"}),Object(y.jsx)("button",{onClick:function(){return oe()},children:"Download userdata3.json"})]}):Object(y.jsx)(y.Fragment,{children:Object(y.jsx)("div",{children:"You have no unsaved changes."})}),V&&V.length?Object(y.jsxs)(y.Fragment,{children:[Object(y.jsx)("br",{}),Object(y.jsx)("i",{children:"Note: Hovering over the art mesh names will highlight them in VTube Studio."})]}):null,Object(y.jsx)("h3",{children:D}),Object(y.jsxs)("label",{children:["Filter:\xa0",Object(y.jsx)("input",{ref:Z,type:"text",defaultValue:j,onChange:function(e){return function(e){localStorage.setItem(x,e),p(e)}(e.target.value)}})]}),Object(y.jsx)("br",{})]}):null,E&&!C?Object(y.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"auto 1fr"},children:[Object(y.jsx)("label",{children:"ArtMesh Name"}),Object(y.jsx)("label",{children:"Tags"}),ue?ue.map((function(e,t){var n;return Object(y.jsxs)(r.Fragment,{children:[Object(y.jsx)("div",{className:"artmeshName",onMouseEnter:function(){return ie(e)},onMouseLeave:function(){return se(e)},children:e}),Object(y.jsxs)("div",{className:"artmeshTags",onMouseEnter:function(){return ie(e)},onMouseLeave:function(){return se(e)},children:[le?null:Object(y.jsx)("input",{type:"text",placeholder:"New tag...",onKeyDown:function(t){t.stopPropagation(),"Enter"===t.key&&t.target instanceof HTMLInputElement&&(ae(e,t.target.value),t.target.value="")},onBlur:function(t){ae(e,t.target.value),t.target.value=""}}),null===Q||void 0===Q||null===(n=Q[e])||void 0===n?void 0:n.map((function(t){return Object(y.jsxs)("div",{className:"tag",onClick:function(){return function(e,t){if(t&&Q&&Q[e]&&Q[e].includes(t)){var n=1===Q[e].length,r=Object(u.a)({},Q);n?delete r[e]:r[e]=r[e].filter((function(e){return e!==t})),X(r)}}(e,t)},children:[Object(y.jsx)("span",{children:t}),Object(y.jsx)("div",{children:"\xd7"})]},t)}))]})]},e+t)})):Object(y.jsx)("i",{children:"No model is currently loaded. Load a model to view the list of artmeshes and tags."})]}):Object(y.jsx)("i",{title:C,children:"Not connected to VTube Studio. Ensure that you are running the latest version of VTube Studio on the same device as this webpage and that the port matches in the settings."})]})},S=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,30)).then((function(t){var n=t.getCLS,r=t.getFID,o=t.getFCP,i=t.getLCP,s=t.getTTFB;n(e),r(e),o(e),i(e),s(e)}))};s.a.render(Object(y.jsx)(o.a.StrictMode,{children:Object(y.jsx)(k,{})}),document.getElementById("root")),S()}},[[29,1,2]]]);
//# sourceMappingURL=main.ba345460.chunk.js.map